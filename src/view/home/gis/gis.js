import Gis from '@/components/ArcGis'
export default {
  name: 'gis',
  data () {
    return {
      gisApiURL: 'http://192.168.2.36:83/arcGIS/3.24/main.js',
      gisServerPath: 'http://192.168.2.36:83/arcGIS',
      MapService: 'http://192.168.2.36:6080/arcgis/rest/services//gzmap18wz/MapServer',
      GeometryService: 'http://192.168.2.178:6080/arcgis/rest/services/Utilities/Geometry/GeometryServer',
      RouteTaskService: 'http://192.168.2.178:6080/arcgis/rest/services/gzMapNaServe/NAServer/%E8%B7%AF%E5%BE%84',
      FindTaskService: 'http://192.168.2.178:6080/arcgis/rest/services/gzRouteName/MapServer',
      position: {x: 276, y: 80},
      gis: {},
      overviewMapFlag: false,
      infoWindowFlag: true,
      graphic: {}
    }
  },

  methods: {
    // 加载api完成
    initCompleted () {
      this.gis = this.$refs.gis
    },

    // 获取地图当前的范围
    getRange (data) {
      console.log('getRange-----------------', data)
    },

    // 初始化地图
    initMap () {
      this.gis.initMap(
        'map',
        {
          point: { longitude: 113.28, latitude: 23.157 } // 地图显示的中心点坐标
          // url: this.mapServer // 地图服务的路径
        }
      )
    },

    // 鹰眼图开关
    overviewMap (data) {
      this.gis.overviewMap(data)
      this.gis.overviewMapShow(false)
    },

    // 根据密度对数据分类
    pointClustering () {
      const jsonPoint = [
        {'id': '40033533336617991', 'name': '兴华派出所', 'longitude': 113.334392, 'latitude': 23.161834},
        {'id': '40033533336617992', 'name': '兴华派出所', 'longitude': 113.334392, 'latitude': 23.161643},
        {'id': '3962295690854410', 'name': '兴华派出所', 'longitude': 113.324392, 'latitude': 23.161834},
        {'id': '4003353333661731', 'name': '兴华派出所', 'longitude': 113.324392, 'latitude': 23.161834},
        {'id': '3962295690854411', 'name': '兴华派出所', 'longitude': 113.324392, 'latitude': 23.161834},
        {'id': '3962295692312677', 'name': '兴华派出所', 'longitude': 113.325463, 'latitude': 23.162122},
        {'id': '4003353346457645', 'name': '兴华派出所', 'longitude': 113.325463, 'latitude': 23.162122},
        {'id': '3962295691935886', 'name': '兴华派出所', 'longitude': 113.323, 'latitude': 23.163},
        {'id': '4003353344442416', 'name': '兴华派出所', 'longitude': 113.323, 'latitude': 23.163},
        {'id': '3962295690707048', 'name': '兴华派出所', 'longitude': 113.323, 'latitude': 23.163},
        {'id': '4003353333104681', 'name': '兴华派出所', 'longitude': 113.323, 'latitude': 23.163},
        {'id': '3962295690854413', 'name': '兴华派出所', 'longitude': 113.324224, 'latitude': 23.163864},
        {'id': '3962295690854414', 'name': '兴华派出所', 'longitude': 113.324224, 'latitude': 23.163864},
        {'id': '4003353333661735', 'name': '兴华派出所', 'longitude': 113.324224, 'latitude': 23.163864},
        {'id': '4003353333661734', 'name': '兴华派出所', 'longitude': 113.324224, 'latitude': 23.163864},
        {'id': '4003353333661699', 'name': '兴华派出所', 'longitude': 113.32295, 'latitude': 23.163243},
        {'id': '3962295690838214', 'name': '兴华派出所', 'longitude': 113.32295, 'latitude': 23.163243},
        {'id': '3962295691935945', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.162},
        {'id': '4003353344475143', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.162},
        {'id': '4003353344475146', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.162},
        {'id': '3962295691935941', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.162},
        {'id': '3962295691935944', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.162},
        {'id': '3962295691935940', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.162},
        {'id': '4003353344475147', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.162},
        {'id': '4003353344475142', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.162},
        {'id': '4003353344442417', 'name': '兴华派出所', 'longitude': 113.324, 'latitude': 23.164},
        {'id': '3962295691935887', 'name': '兴华派出所', 'longitude': 113.324, 'latitude': 23.164},
        {'id': '4003353344475165', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.163},
        {'id': '3962295691935942', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.163},
        {'id': '4003353344475164', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.163},
        {'id': '3962295691935943', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.163},
        {'id': '3962295691935963', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.163},
        {'id': '4003353344475145', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.163},
        {'id': '3962295691935962', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.163},
        {'id': '4003353344475144', 'name': '兴华派出所', 'longitude': 113.326, 'latitude': 23.163}, {'id': '3962295690707047', 'name': '兴华派出所', 'longitude': 113.325, 'latitude': 23.164}, {'id': '4003353333104680', 'name': '兴华派出所', 'longitude': 113.325, 'latitude': 23.164}, {'id': '3962295691935885', 'name': '兴华派出所', 'longitude': 113.323, 'latitude': 23.164}, {'id': '4003353344442415', 'name': '兴华派出所', 'longitude': 113.323, 'latitude': 23.164}, {'id': '3962295690707046', 'name': '兴华派出所', 'longitude': 113.322, 'latitude': 23.162}, {'id': '3962295690608844', 'name': '天河区城管执法局', 'longitude': 113.322, 'latitude': 23.162}, {'id': '4003353332924457', 'name': '天河区城管执法局', 'longitude': 113.322, 'latitude': 23.162}, {'id': '4003353333104679', 'name': '兴华派出所', 'longitude': 113.322, 'latitude': 23.162}, {'id': '3962295687184458', 'name': '5574兴华派出所', 'longitude': 113.325134, 'latitude': 23.164413}, {'id': '4003353324257303', 'name': '5574兴华派出所', 'longitude': 113.325134, 'latitude': 23.164413}, {'id': '4003353333661702', 'name': '兴华派出所', 'longitude': 113.323314, 'latitude': 23.164344}, {'id': '3962295690838217', 'name': '兴华派出所', 'longitude': 113.323314, 'latitude': 23.164344}, {'id': '4003353333661703', 'name': '兴华派出所', 'longitude': 113.323314, 'latitude': 23.164344}, {'id': '3962295690838218', 'name': '兴华派出所', 'longitude': 113.323314, 'latitude': 23.164344}, {'id': '4003353344475140', 'name': '兴华派出所', 'longitude': 113.324, 'latitude': 23.16}, {'id': '3962295691935938', 'name': '兴华派出所', 'longitude': 113.324, 'latitude': 23.16}, {'id': '3962295690838216', 'name': '兴华派出所', 'longitude': 113.325334, 'latitude': 23.164643}, {'id': '4003353333661701', 'name': '兴华派出所', 'longitude': 113.325334, 'latitude': 23.164643}, {'id': '3962295691935939', 'name': '兴华派出所', 'longitude': 113.322, 'latitude': 23.161}, {'id': '4003353344475141', 'name': '兴华派出所', 'longitude': 113.322, 'latitude': 23.161}, {'id': '3962295690854402', 'name': '兴华派出所', 'longitude': 113.321856, 'latitude': 23.161061}, {'id': '4003353333661724', 'name': '兴华派出所', 'longitude': 113.321856, 'latitude': 23.161061}, {'id': '3962295690854403', 'name': '兴华派出所', 'longitude': 113.321856, 'latitude': 23.161061}, {'id': '4003353333661723', 'name': '兴华派出所', 'longitude': 113.321856, 'latitude': 23.161061}, {'id': '4003353344475138', 'name': '兴华派出所', 'longitude': 113.323, 'latitude': 23.16}, {'id': '4003353344475137', 'name': '兴华派出所', 'longitude': 113.323, 'latitude': 23.16}, {'id': '3962295691935936', 'name': '兴华派出所', 'longitude': 113.323, 'latitude': 23.16}, {'id': '3962295691935935', 'name': '兴华派出所', 'longitude': 113.323, 'latitude': 23.16}, {'id': '3962295690707052', 'name': '兴华派出所', 'longitude': 113.322, 'latitude': 23.164}, {'id': '4003353333104685', 'name': '兴华派出所', 'longitude': 113.322, 'latitude': 23.164}]
      this.getClusteringDataCal(this.gis.getClusteringData(jsonPoint, 16))
    },
    // 根据密度对数据分类的回调，生成聚合点
    getClusteringDataCal (data) {
      this.gis.pointClustering(data)
    },
    // 点击聚合点的回调
    clusterGraphicOnclickCalFun (data) {
      console.log('clusterGraphicOnclickCalFun---------------------------', data)
    },

    // 画一条线
    drawALine () {
      this.gis.drawALine({calculate: true, show: true})
    },

    // 画线的回调
    drawALineCal (data) {
      console.log('drawALineCal---------------------------', data)
      this.gis.cleanToolbar()
    },

    // 清空
    deleteSymbol () {
      this.gis.deleteSymbol(this.graphic)
    },

    // 计算面积
    getArea () {
      let str = '113.279879880000,23.133414960000,113.278703040000,23.133714030000,113.277876119000,23.133699000000,113.277844583000,23.133698123000,113.277264120000,23.133681990000,113.276547000000,23.133681000000,113.275818000000,23.133677040000,113.273910000000,23.133625020000,113.273448120000,23.133614040000,113.272923960000,23.133600990000,113.272609903000,23.133593312000,113.272309080000,23.133585960000,113.272251840000,23.133984030000,113.272009920000,23.134526999000,113.271936120000,23.134726980000,113.271320880000,23.134653000000,113.269166584000,23.134570812000,113.269119840000,23.134569030000,113.269125960000,23.133957030000,113.269141080000,23.133893039000,113.269164840000,23.133652020000,113.269182120000,23.133549960000,113.269151160000,23.133395970000,113.269061880000,23.133186000000,113.268909960000,23.132945970000,113.268885342000,23.132898431000,113.268885120000,23.132898000000,113.268828959000,23.132765969000,113.268809880000,23.132715030000,113.268813840000,23.132696040000,113.268839040000,23.132577960000,113.268844080000,23.132557980000,113.268854160000,23.132490029000,113.268863880000,23.132427029000,113.268876120000,23.132348009000,113.268870000000,23.132340989000,113.268821040000,23.132334959000,113.268807000000,23.132415960000,113.268660840000,23.132393010000,113.268660120000,23.132349990000,113.268664080000,23.132325960000,113.268706920000,23.132321010000,113.268717000000,23.132226960000,113.268722040000,23.132186999000,113.268759120000,23.132189970000,113.268786120000,23.132193029000,113.268794040000,23.132089980000,113.268746160000,23.132087010000,113.268744000000,23.132113019000,113.268722040000,23.132111040000,113.268720960000,23.132120039000,113.268669120000,23.132115000000,113.268677040000,23.132027970000,113.268690000000,23.131919970000,113.269016160000,23.131940040000,113.269012920000,23.131848959000,113.268911040000,23.131826010000,113.268912840000,23.131722960000,113.268916080000,23.131605960000,113.268966840000,23.131377990000,113.269110840000,23.131413000000,113.269151880000,23.131322010000,113.269073040000,23.131304010000,113.269141080000,23.130963000000,113.269257000000,23.130999990000,113.269268160000,23.131001970000,113.269304880000,23.130840960000,113.269282920000,23.130820980000,113.269303080000,23.130606960000,113.269295880000,23.130520020000,113.269293000000,23.130395009000,113.269042080000,23.130360000000,113.269053960000,23.130244980000,113.269096080000,23.130249030000,113.269089960000,23.130289979000,113.269338000000,23.130339030000,113.269428000000,23.130000000000,113.268965040000,23.129944020000,113.268526920000,23.129890019000,113.268465000000,23.129835029000,113.268531960000,23.129511030000,113.268584880000,23.129277030000,113.268411000000,23.129227980000,113.268359160000,23.129416980000,113.268286080000,23.129399970000,113.268268080000,23.129457030000,113.268106080000,23.129416980000,113.268045960000,23.129603010000,113.267623420000,23.129481836000,113.267373179000,23.129261410000,113.267365297000,23.129257402000,113.267348822000,23.129248557000,113.267033835000,23.129079449000,113.267000160000,23.129061030000,113.266954080000,23.129143020000,113.266857960000,23.129089020000,113.266865160000,23.129076959000,113.266839959000,23.129063010000,113.266811160000,23.129110980000,113.266645920000,23.129025030000,113.266662840000,23.129001000000,113.266602000000,23.128959959000,113.266604880000,23.128949970000,113.266639080000,23.128849979000,113.266699920000,23.128718040000,113.266497960000,23.128652969000,113.266464840000,23.128682040000,113.266402920000,23.128668990000,113.266158840000,23.129187030000,113.266143000000,23.129217000000,113.265828371000,23.129209366000,113.265839357000,23.128894429000,113.265955075000,23.128881078000,113.265999583000,23.128458260000,113.265664785000,23.128437969000,113.265693000000,23.128157970000,113.265699120000,23.128030979000,113.265541080000,23.128008030000,113.265429840000,23.128014960000,113.265272160000,23.127660989000,113.265360000000,23.127240960000,113.264961840000,23.127087959000,113.265088920000,23.126676029000,113.265489960000,23.126736959000,113.265622080000,23.126686020000,113.265705960000,23.126590980000,113.265825840000,23.126604030000,113.265861120000,23.126427000000,113.265906840000,23.126311979000,113.265747000000,23.126245019000,113.265677880000,23.126336999000,113.265406080000,23.126262030000,113.265493920000,23.126120010000,113.265641880000,23.125619970000,113.266045080000,23.125742010000,113.266108080000,23.125596030000,113.266233000000,23.125624020000,113.266266840000,23.125518990000,113.266441092000,23.124994024000,113.266723316000,23.125090746000,113.267439000000,23.125336020000,113.267909880000,23.125358970000,113.267919606000,23.125359639000,113.268201840000,23.125379040000,113.268238920000,23.125403970000,113.268481920000,23.125384980000,113.268858840000,23.125390020000,113.269844880000,23.125421970000,113.269965120000,23.125379040000,113.270022000000,23.125377960000,113.270073840000,23.125356990000,113.270076000000,23.125484970000,113.270577120000,23.125528980000,113.272129487000,23.125499765000,113.272647840000,23.125490010000,113.272695000000,23.125361040000,113.273285040000,23.125178969000,113.273431920000,23.125578030000,113.273539920000,23.126104980000,113.273574120000,23.126396040000,113.273574681000,23.126417596000,113.273580960000,23.126659020000,113.273588880000,23.126985990000,113.273607960000,23.127494040000,113.273669880000,23.127870959000,113.273807040000,23.128233030000,113.273965080000,23.128493039000,113.274079153000,23.128659756000,113.274088920000,23.128674030000,113.274104040000,23.128696980000,113.274248040000,23.128936019000,113.274295920000,23.129099010000,113.274295920000,23.129450010000,113.274240120000,23.129676000000,113.274432000000,23.129691030000,113.274951840000,23.129714970000,113.275581306000,23.129707435000,113.275621080000,23.129706960000,113.277141000000,23.129681039000,113.277937015000,23.129667879000,113.279078880000,23.129649000000,113.279515920000,23.129529030000,113.279550461000,23.129519571000,113.281450920000,23.128999020000,113.281452000000,23.128999020000,113.281461914000,23.128996309000,113.281697160000,23.128931970000,113.281810920000,23.129295030000,113.282022960000,23.129229960000,113.282231040000,23.129610030000,113.282544960000,23.130442980000,113.282652960000,23.130560969000,113.282736120000,23.130684989000,113.282802000000,23.130835020000,113.282926920000,23.131137960000,113.282948160000,23.131328040000,113.283150120000,23.131698030000,113.283379080000,23.132148030000,113.283408960000,23.132315969000,113.283442080000,23.132707020000,113.283438840000,23.132931030000,113.283461160000,23.133394979000,113.283297000000,23.133391020000,113.282324786000,23.133369053000,113.281436880000,23.133348990000,113.280697080000,23.133330990000,113.279879880000,23.133414960000'
      let arr = str.split(',')
      let polygon = []
      for (let i = 0; i < arr.length; i++) {
        if (i % 2 === 0) {
          polygon.push([arr[i]])
        } else {
          polygon[polygon.length - 1][1] = arr[i]
        }
      }
      this.graphic = this.gis.addAreaSymbol(polygon, {})
      this.gis.getArea(polygon)
    },

    // infoWindow
    showInfoWindow () {
      let data = {
        point: {
          longitude: '113.279879880000',
          latitude: '23.133414960000'
        },
        title: 'title',
        content: 'content'
      }
      this.gis.infoWindows(this.infoWindowFlag, data)
      this.infoWindowFlag = !this.infoWindowFlag
    }

  },

  components: {
    Gis
  }

}
